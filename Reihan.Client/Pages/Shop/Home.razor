@page "/"
@inject IProductClient ProductClient
@inject ICategoryClient CategoryClient
@inject NavigationManager NavigationManager

<MudContainer MaxWidth="MaxWidth.Large">
    <!-- معرفی -->
    <MudPaper Class="pa-6 mb-6 d-flex justify-center align-center">
        <MudText Typo="Typo.h5">به فروشگاه ریحان خوش آمدید</MudText>
    </MudPaper>

    <!-- محصولات جدید -->
    <MudText Typo="Typo.h6" Class="mb-2">🆕 محصولات جدید</MudText>
    <MudGrid>
        @foreach (var product in LatestProducts)
        {
            <MudItem xs="12" sm="6" md="3">
                <ProductCard Product="product" />
            </MudItem>
        }
    </MudGrid>

    <!-- دسته‌بندی‌ها -->
    <MudText Typo="Typo.h6" Class="mt-8 mb-2">🎯 دسته‌بندی‌ها</MudText>
    <MudGrid>
        @foreach (var category in Categories)
        {
            <MudItem xs="6" sm="4" md="3">
                <MudPaper Class="pa-4 hover:shadow-lg cursor-pointer" @onclick="@(() => GoToCategory(category.Id))">
                    <MudText Typo="Typo.subtitle1">@category.Name</MudText>
                    <MudText Typo="Typo.caption">@category.ProductsInThisCategory محصول</MudText>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
</MudContainer>

@code {
    private List<ProductCardDto> LatestProducts = new();
    private List<CategoryDto> Categories = new();

    protected override async Task OnInitializedAsync()
    {
        LatestProducts = await ProductClient.GetLatestAsync();
        Categories = await CategoryClient.GetAllAsync();
    }

    private void GoToCategory(int categoryId)
    {
        NavigationManager.NavigateTo($"/shop?category={categoryId}");
    }
}
